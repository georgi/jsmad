this.audioLib=(function(q,h){var n=q.Float32Array||Array,e=this;function b(u){var v=new n(u);v.subarray=v.subarray||v.slice;return v}e.Float32Array=b;function s(z,v,w,A,y){this.attack=v||50;this.decay=w||50;this.sustain=A||1;this.release=y||50;this.value=0;var C=this,u=3,x=false,B=[function(){C.value+=1000/C.sampleRate/C.attack;if(C.value>=1){u=1}},function(){C.value-=1000/C.sampleRate/C.decay*C.sustain;if(C.value<=C.sustain){u=2}},function(){C.value=C.sustain},function(){C.value=h.max(0,C.value-1000/C.sampleRate/C.release)}];this.generate=function(){B[u]();return this.value};this.triggerGate=function(D){x=D;u=x?0:3};this.sampleRate=z}function t(){var C=this,z=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function A(D,E){this.key=D;this.velocity=E;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(G,F){this.key=G;this.v=F;this.onKeyChange()};this.getFrequency=function(){return C.getFrequencyForKey(this.key)};C.voice.apply(this)}function x(E){var D;for(D=0;D<z.length;D++){if(z[D].key===E){z.splice(D--,1)}}}function B(D,E){x(D);z.push({key:D,velocity:E})}function v(){var D,F,E=[];if(C.legato===0){E=z.slice(0)}else{if(C.legato===1){for(D=0;D<z.length;D++){for(F=0;F<E.length;F++){if(F===z.length-1||(E[F-1].key>z[D].key&&E[F].key<z[D].key)){E.splice(F,0,z[D]);break}}}}else{if(C.legato===2){for(D=0;D<z.length;D++){for(F=0;F<E.length;F++){if(F===z.length-1||(E[F-1].key<z[D].key&&E[F].key>z[D].key)){E.splice(F,0,z[D]);break}}}}}}C.activeKeys=E.slice(-C.polyphony)}function u(){if(!C.voice){return}var D,F,E;if(C.polyphony===1&&C.activeKeys.length>0){D=C.activeKeys.length-1;if(C.voices.length===0){C.voices.push(new A(C.activeKeys[D].key,C.activeKeys[D].velocity))}else{C.voices[0].changeKey(C.activeKeys[D].key,C.activeKeys[D].velocity)}}else{for(F=0;F<C.activeKeys.length;F++){E=false;for(D=0;D<C.voices.length;D++){if(C.voices[D].key===C.activeKeys[F].key){E=true;break}}if(!E){C.voices.push(new A(C.activeKeys[D].key,C.activeKeys[D].velocity))}}}for(D=0;D<C.voices.length;D++){E=false;for(F=0;F<C.activeKeys.length;F++){if(C.voices[D].key===C.activeKeys[F].key){E=true;break}}if(!E){C.voices[D].noteOff();C.voices.splice(D--,1)}}}function y(E,F){var D=C.activeKeys.length;B(E,F);v();u();C.onNoteOn(E,F);if(C.retrigger===0||(D===0&&C.activeKeys.length>0)){C.onTrigger()}}function w(D,E){x(D,E);v();u();C.onNoteOff(D,E);if(C.activeKeys===0){C.onRelease()}}this.onMidi=function(D){switch(D.status){case 9:y(D.data1,D.data2/127);break;case 8:w(D.data1,D.data2/127);break;case 14:C.pitchBend=(D.data1*128+D.data2-8192)/8192;break}};this.getFrequencyForKey=function(D){return 440*h.pow(1.059,D-69)};this.getFrequency=function(){var E=[],D;for(D=0;D<C.activeKeys.length;D++){E.push(C.getFrequencyForKey(C.activeKeys[D].key))}if(E.length>2){return E[0]}return E};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(D){C.onMidi(D)}}function r(y,v,x,z){var w=this,u=0;w.sampleRate=y;w.stepLength=v||200;w.steps=x||[1,0];w.value=0;w.attack=z||0;w.generate=function(){var C=w.sampleRate/1000*w.stepLength,E=w.steps,D=C*E.length,G,A,B,F,H;if(++u===D){u=0}G=u/D*E.length;A=G%1;G=h.floor(G);B=(G||E.length)-1;F=E[G]-E[B];H=E[G];if(A<w.attack){H-=F-F/w.attack*A}w.value=H;return H};w.triggerGate=function(){u=0}}function m(C,u,x,y){var D=this,w=new b(u),v=u-1,A=x,B=0,z=0;this.volume=D.volume||1;D.sampleRate=C;D.pushSample=function(E){w[A++]=E;z=w[B++]*D.volume;if(A>=v){A=0}if(B>=v){B=0}return z};D.getMix=function(){return z}}function p(B,y,x,u){var C=this,w,v,A;C.delayTime=y||30;C.depth=x||3;C.freq=u||0.1;function z(){w=new b(C.sampleRate*0.1);v=0;var E,D=w.length;for(E=0;E<D;E++){w[E]=0}}C.sampleRate=B;C.osc=new c(B,u);C.calcCoeff=z;C.pushSample=function(E){if(++v>=w.length){v=0}w[v]=E;C.osc.generate();var D=C.delayTime+C.osc.getMix()*C.depth;D*=C.sampleRate/1000;D=v-h.floor(D);while(D<0){D+=w.length}A=w[D];return A};C.getMix=function(){return A};z()}function f(E,A,y){var I=this,z=(!E?44100:E)*2,D=new b(z),C=0,B=0,x=0,H=0,F=h.floor;function G(){B=z/I.samplerate/I.time*1000;x=I.time}function v(K,M,L){var J=M;while(J++!==L){if(J>=z){J=0}D[J]=K}}function w(J){D[C++]+=J;if(C>I.time/1000*I.samplerate){C=0}D[C]=D[C]*I.feedback}function u(K){var J=F(C);if(x!==I.time){G()}C+=B;if(C>=z){C-=z}v(K+D[F(C)]*I.feedback,J,F(C))}this.time=!A?1000:A;this.feedback=0;this.algorithm=0;this.samplerate=E;this.pushSample=function(J){if(this.algorithm===0){w(J)}else{u(J)}H=D[F(C)];return H};this.getMix=function(){return H}}function k(u){var y=new g(u,720.484),x=new g(u,723.431),w=new g(u,1),v=0;this.gain=4;this.master=1;this.sampleRate=u;this.filters=[y,x,w];this.pushSample=function(z){y.pushSample(z);v=y.getMix(1)*this.gain;v=h.atan(v)+v;if(v>0.4){v=0.4}else{if(v<-0.4){v=-0.4}}x.pushSample(v);w.pushSample(x.getMix(0));v=w.getMix(1)*this.master;return v};this.getMix=function(){return v}}(function(v,u){u.Capper=function(x,y){var w=this,z=0;w.sampleRate=x;w.cap=y||1;w.pushSample=function(A){z=A>w.cap?2*w.cap-A:A<-w.cap?-2*w.cap-A:A;return z};w.getMix=function(){return z}};u.Expo=function(x,y){var w=this;sample=0;w.sampleRate=x;w.param=y||0.8;w.pushSample=function(z){sample=(z<0?-h.pow(w.param*2,-z):h.pow(w.param*2,z))/10;return sample};w.getMix=function(){return sample}}}(this,e));function g(z,v,G,E){var H=this,B=[0,0,0,0],u,x,F,w,D=h.sin,y=h.min,A=h.pow;H.cutoff=!v?20000:v;H.resonance=!G?0.1:G;H.samplerate=z;H.type=E||0;function C(){u=2*D(h.PI*y(0.25,H.cutoff/(H.samplerate*2)));x=y(2*(1-A(H.resonance,0.25)),y(2,2/u-u*0.5))}H.pushSample=function(I){if(F!==H.cutoff||w!==H.resonance){C();F=H.cutoff;w=H.resonance}B[3]=I-x*B[2];B[0]=B[0]+u*B[2];B[1]=B[3]-B[0];B[2]=u*B[1]+B[2];B[3]=I-x*B[2];B[0]=B[0]+u*B[2];B[1]=B[3]-B[0];B[2]=u*B[1]+B[2];return B[H.type]};H.getMix=function(I){return B[I||H.type]}}function a(w,x,y){var u=this,v=[0,0];u.cutoff=!x?20000:x;u.resonance=!y?0:y;u.samplerate=w;u.pushSample=function(A){var z=u.cutoff*2/u.samplerate,B=u.resonance+u.resonance/(1-z);v[0]=v[0]+z*(A-v[0]+B*(v[0]-v[1]));v[1]=v[1]+z*(v[0]-v[1]);return v[1]};u.getMix=function(){return v[1]}}function o(A,x,H){var I=this,F=0,z=0,C=h.PI*2,E,v,u,D,G,y;I.cutoff=!x?20000:x;I.resonance=!H?1:H;I.samplerate=A;function B(){E=C*I.cutoff/I.samplerate;v=1-E/(2*(I.resonance+0.5/(1+E))+E-2);u=v*v;D=u+1-2*h.cos(E)*v}I.pushSample=function(w){if(G!==I.cutoff||y!==I.resonance){B();G=I.cutoff;y=I.resonance}F+=(w-z)*D;z+=F;F*=u;return z};I.getMix=function(){return z};B()}function c(x,A){var v=0,z=0,w=h.PI*2,u=new b(1),y;this.frequency=440;if(A){this.frequency=A}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=x;this.generate=function(){var E=this.frequency+0,D=this.pulseWidth,C,B=arguments.length;for(C=0;C<B;C++){E+=E*arguments[C]}v=(v+E/this.samplerate/2)%1;z=(v+this.phaseOffset)%1;z=z<D?z/D:(z-D)/(1-D)};this.getMix=function(){return y[this.waveShape]()};this.getPhase=function(){return z};this.reset=function(){v=0};this.setWavetable=function(B){u=B;return true};this.sine=function(){return h.sin(z*w)};this.triangle=function(){if(z<0.5){return 4*z-1}return 3-4*z};this.square=function(){return(z<0.5)?-1:1};this.sawtooth=function(){return 1-z*2};this.invSawtooth=function(){return z*2-1};this.pulse=function(){if(z<0.5){if(z<0.25){return z*8-1}else{return 1-(z-0.25)*8}}return -1};this.wavetable=function(){return u[h.floor(z*u.length)]};y=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}function d(w,y,z){var v=this,u=[],x;v.sampleRate=w;v.sample=y;v.pitch=z||440;v.delayStart=0;v.delayEnd=0;v.maxVoices=0;v.noteOn=function(E){E=E||v.pitch;var D=E/v.pitch,C=v.sampleRate,F=C*v.delayStart,A=v.sample.length-C*v.delayEnd,B={f:E,p:F,s:D,l:A};u.push(B);return B};v.generate=function(){var A,B;for(A=0;A<u.length;A++){B=u[A];B.p+=B.s;B.p>B.l&&u.splice(A--,1)&&B.onend&&B.onend()}};v.getMix=function(){var B=0,A;for(A=0;A<u.length;A++){B+=d.interpolate(v.sample,u[A].p)}return B};sampler.loadWav=function(C,B){var A=e.PCMData.decode(C);v.sample=B?d.resample(A.data,A.sampleRate,1,v.sampleRate,1):A.data}}d.interpolate=function(u,y){var x=h.floor(y),w=x+1,v=y-x;w=w<u.length?w:0;return u[x]*(1-v)+u[w]*v};d.resample=function(A,u,D,E,w){var y=E/u*w/D,z=A.length,v=h.ceil(z/y),C=new b(v),B,x;for(B=0,x=0;B<z;B+=y){C[x++]=d.interpolate(A,B)}return C};(function(u){function z(G){var I,H=G.length,F={};for(I=0;I<H;I++){F[G[I]]=true}return F}var C=z([256,512,1024,2048,4096,8192,16384]),v=z([48000,44100,22050]),E=String.fromCharCode;function D(K,J,I,H){var G=D.devices,F;for(F in G){if(G.hasOwnProperty(F)&&G[F].enabled){try{return new G[F](K,J,I,H)}catch(L){}}}throw"No audio device available."}function w(F){this.boundTo=F;this.buffers=[];F.activeRecordings.push(this)}w.prototype={toWav:function(F){return e.PCMData.encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:F})},add:function(F){this.buffers.push(F)},clear:function(){this.buffers=[]},stop:function(){var F=this.boundTo.activeRecordings,G;for(G=0;G<F.length;G++){if(F[G]===this){F.splice(G--,1)}}},join:function(){var J=0,K=0,H=this.buffers,F,L,I,G=H.length;for(I=0;I<G;I++){J+=H[I].length}F=new b(J);for(I=0;I<G;I++){for(L=0;L<H[I].length;L++){F[K+L]=H[I][L]}K+=H[I].length}return F}};function B(F){this.type=F}B.prototype={record:function(){return new w(this)},recordData:function(G){var I=this.activeRecordings,H,F=I.length;for(H=0;H<F;H++){I[H].add(G)}},writeBuffers:function(H){var G=this.buffers,F=H.length,I,K,J,L;if(G){for(J=0;J<G.length;J++){I=G[J];K=I.length;for(L=0;L<F&&L<K;L++){H[L]+=I[L]}G[J]=I.subarray(L);J>=K&&G.splice(J--,1)}}},writeBuffer:function(G){var F=this.buffers=this.buffers||[];F.push(G);return F.length}};function A(L,J,G,N){N=v[N]?N:44100;G=C[G]?G:N/2;var O=this,I=0,M=null,K=new Audio(),F;function H(){var P,S,R,Q;if(M){P=K.mozWriteAudio(M);I+=P;if(P<M.length){M=M.subarray(P);return M}M=null}S=K.mozCurrentSampleOffset();R=Number(S+G*J-I)+0;if(R>0){Q=new b(R);L&&L(Q,O.channelCount);O.writeBuffers(Q);O.recordData(Q);P=K.mozWriteAudio(Q);if(P<Q.length){M=Q.subarray(P)}I+=P}}K.mozSetup(J,N);F=setInterval(H,20);this.kill=function(){clearInterval(F)};this.activeRecordings=[];this.sampleRate=N;this.channelCount=J;this.type="moz"}A.enabled=true;A.prototype=new B("moz");function y(K,J,G,M){M=v[M]?M:44100;G=C[G]?G:4096;var N=this,F=new (window.AudioContext||webkitAudioContext)(),I=F.createJavaScriptNode(G,0,J),L=F.createBufferSource();function H(V){var O=V.outputBuffer,R=O.numberOfChannels,T,Q,S=O.length,W=O.size,U=new Array(R),P=new b(S*R);for(T=0;T<R;T++){U[T]=O.getChannelData(T)}K&&K(P,R);N.writeBuffers(P);N.recordData(P);for(T=0;T<S;T++){for(Q=0;Q<R;Q++){U[Q][T]=P[T*R+Q]}}}I.onaudioprocess=H;L.connect(I);I.connect(F.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=F.sampleRate;this.channelCount=J;this.type="webkit"}y.enabled=true;y.prototype=new B("webkit");function x(K,J,I,H){H=v[H]?H:44100;I=C[I]?bufferSize:8192;var F=this,L;function G(){var M=new b(I*J);K&&K(M,F.channelCount);F.writeBuffers(M);F.recordData(M)}this.kill=function(){clearInterval(L)};this.activeRecordings=[];setInterval(G,I/H*1000);this.sampleRate=H;this.channelCount=J;this.type="dummy"}x.enabled=true;x.prototype=new B("dummy");D.deviceClass=B;D.propertyEnum=z;D.devices={moz:A,webkit:y,dummy:x};u.AudioDevice=D}(this));this.AudioDevice.createScheduled=function(y){var x=[],u=0,v;function w(A,D){var z=A.length/D,G=v.chunkSize,C=G*D,F,B,E;u=+new Date;for(B=0;B<z;B+=G){for(F=0;F<x.length;F++){x[F].t-=G;if(x[F].t<=0){x[F].f.apply(x[F].x,x[F].a);x.splice(F--,1)}}E=B*C;y(A.subarray(E,E+C),D)}}v=this.apply(this,[w].concat(Array.prototype.splice.call(arguments,1)));v.schedule=function(B,A,z){x.push({f:B,x:A,a:z,t:((new Date-u)*0.001*this.sampleRate)})};v.chunkSize=1;return v};(function(C,B){var u=String.fromCharCode,w=true,A=false;function x(F,E){return E?u(F&255)+x(F>>8,E-1):""}function z(F,E){return E?z(F>>8,E-1)+u(255-F&255):""}function v(G,F,E){return E?z(G,F):x(G,F)}function D(H,I){var F=H.length,J=F-1,G=0,K=B.pow,E;if(I){for(E=0;E<F;E++){G+=(255-H.charCodeAt(E))*K(256,J-E)}}else{for(E=0;E<F;E++){G+=H.charCodeAt(E)*K(256,E)}}return G}function y(G,R,H,N){var S=B.pow,E=B.floor,J=y.convertFromBinary,Q=y.convertToBinary,L=G/8,F=S(2,G),O=F/2,K=O-0.5,M=O-1,P=1/K,I=1/M;return N?H?R?function(U,T){U=E(U*M);return Q(U<0?O-U:U,L,T)}:function(U,T){return Q(E(U*M),L,T)}:R?function(U,T){return Q(U<0?M-U:U,L,T)}:function(U,T){return Q(U,L,T)}:H?R?function(V,T){var U=J(V,T);return U>K?(K-U)*P:U*I}:function(T,U){return J(T,U)*I}:R?function(V,T){var U=J(V,T);return U>M?M-U:U}:function(T,U){return J(T,U)}}y.convertToBinary=v;y.convertFromBinary=D;y.fromFloat32=y(32,w,w,w);y.toFloat32=y(32,w,w,A);y.fromInt32=y(32,w,A,w);y.toInt32=y(32,w,A,A);y.fromInt24=y(24,w,A,w);y.toInt24=y(24,w,A,A);y.fromInt16=y(16,w,A,w);y.toInt16=y(16,w,A,A);y.fromInt8=y(8,w,A,w);y.toInt8=y(8,w,A,A);y.fromUint32=y(32,A,A,w);y.toUint32=y(32,A,A,A);y.fromUint16=y(16,A,A,w);y.toUint16=y(16,A,A,A);y.fromUint8=y(8,A,A,w);y.toUint8=y(8,A,A,A);C.Binary=y}(this,h));(function(y,x){function w(B){this.data=B}var z=w.prototype={read:function(C){var D=this,B=D.data.substr(0,C);D.data=D.data.substr(C);D.pointer+=C;return B}},A,u;function v(B,D,C){var E=D/8;z["read"+B+D]=function(){return C(this.read(E))}}for(A in x){u=/to([a-z]+)([0-9]+)/i.exec(A);u&&v(u[1],u[2],x[A])}y.Stream=w;w.newType=v}(this,this.Binary));this.PCMData=(function(v,u){function w(x){return(typeof x==="string"?w.decode:w.encode)(x)}w.decode=function(M){var aa=new u(M),T=aa.read(4),I=aa.readUint32();aa=new u(aa.read(I));var X=aa.read(4),U=aa.read(4),K=aa.readUint32(),ad=new u(aa.read(K)),ab=ad.readUint16(),F=ad.readUint16(),P=ad.readUint32(),Z=ad.readUint32(),S=ad.readUint16(),E=S/F,V=K===16?ad.readUint16():ad.readUint32(),W="readInt"+(E*8),Q=1/h.pow(2,E*8-1),ac,R,O,H,N,J,Y,G,L={};while(aa.data){ac=aa.read(4);R=aa.readUint32();H=aa.read(R);Y=L[ac]=L[ac]||[];if(ac==="data"){O=~~(R/E);N=new u(H);J=(typeof b!=="undefined"?b:Array)(O);for(G=0;G<O;G++){J[G]=N[W]()*Q}}else{Y.push(H)}}return{channelCount:F,bytesPerSample:S/F,sampleRate:Z/S,chunks:L,data:J}};w.encode=function(A){var F=v.fromUint32,z=v.fromUint16,I=A.data,R=A.sampleRate,N=A.channelCount||1,D=A.bytesPerSample||1,M=D*8,P=N*D,C=R*P,O=I.length,Q=O*D,J=h.pow(2,M-1)-1,S=v["fromInt"+M],K=[],L="",B,E,H,G;K.push("fmt "+F(16)+z(1)+z(N)+F(R)+F(C)+z(P)+z(M));for(E=0;E<O;E++){L+=S(I[E]*J)}K.push("data"+F(Q)+L);G=A.chunks;if(G){for(E in G){if(G.hasOwnProperty(E)){B=G[E];for(H=0;H<B.length;H++){L=B[H];K.push(E+F(L.length)+L)}}}}K=K.join("");return"RIFF"+F(K.length)+"WAVE"+K};return w}(this.Binary,this.Stream));(function(v,w){var C=w.sin,G=w.cos,F=w.sqrt,A=w.floor,B=w.pow,u=w.ln2,z=w.PI,y=z*2;function x(I,H,J){I.sampleRate=H;I.bufferSize=J;I.bandWidth=0.5*J*H*0.5;I.spectrum=new b(J*0.5);I.real=new b(J);I.imag=new b(J);I.peakBand=I.peak=0;I.getBandFrequency=function(K){return this.bandwidth*K+this.bandwidth*0.5};I.calculateSpectrum=function(){var V=this,R=V.spectrum,S=V.real,K=V.imag,U=0.5*V.bufferSize,L=F,Q=J*0.5,P,T,O,M;for(M=0;M<Q;M++){P=S[M];T=K[M];O=U*L(P*P+T*T);if(O>V.peak){V.peakBand=M;V.peak=O}}}}function E(I,H,J){return new E[I](H,J)}function D(I,O){var H=this,L=O*O*0.5,K=new b(L),M=new b(L),J;x(H,I,O);for(J=0;J<L;J++){K[J]=C(J*y/O);M[J]=G(J*y/O)}H.forward=function(T){var Y=this,W=Y.real,P=Y.imag,V=Y.bufferSize*0.5,R=T.length,U,X,S,Q,Z;for(S=0;S<V;S++){U=X=0;for(Q=0;Q<R;Q++){U+=M[Z=S*Q]*T[Q];X+=K[Z]*T[Q]}W[S]=U;P[S]=X}return Y.calculateSpectrum()}}v.FourierTransform=E;E.DFT=D}(this,h));e.ADSREnvelope=s;e.MidiEventTracker=t;e.StepSequencer=r;e.AllPassFilter=m;e.Chorus=p;e.Delay=f;e.Distortion=k;e.IIRFilter=g;e.LowPassFilter=a;e.LP12Filter=o;e.Oscillator=c;e.Sampler=d;function l(){var u=Array.prototype.splice.call(arguments,0),v=u.prototype=l.prototype;for(i in v){if(v.hasOwnProperty(i)){u[i]=v[i]}}return u}(function(u){l.prototype=u;u.pushSample=function(y){var v=this,x,w;for(w=0;w<v.length;w++){x=v[w].mix;y=v[w].pushSample(y)*x+y*(1-x)}return y}}({}));function j(){}j.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return l.apply(0,[this].concat(Array.prototype.splice.call(arguments,0)))}};(function(y,v,x,u,w){x=e.effects={};for(v=0;v<y.length;v++){u=y[v];x[u]=e[u];w=x[u].prototype=new j();w.name=w.fxid=u}}(["AllPassFilter","Chorus","Delay","Distortion","IIRFilter","LowPassFilter","LP12Filter"]));e.EffectChain=l;e.EffectClass=j;e.version="0.4.4";return e}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);